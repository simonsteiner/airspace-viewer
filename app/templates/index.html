<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ title }}</title>

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{ request.url }}" />
    <meta property="og:title" content="Airspace Viewer ‚úà" />
    <meta
      property="og:description"
      content="A Python-based interactive airspace visualization tool for viewing OpenAir airspace files."
    />
    <meta
      property="og:image"
      content="{{ url_for('static', filename='og-preview.png', _external=True) }}"
    />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="{{ request.url }}" />
    <meta property="twitter:title" content="Airspace Viewer ‚úà" />
    <meta
      property="twitter:description"
      content="A Python-based interactive airspace visualization tool for viewing OpenAir airspace files."
    />
    <meta
      property="twitter:image"
      content="{{ url_for('static', filename='og-preview.png', _external=True) }}"
    />

    <!-- Additional meta tags -->
    <meta
      name="description"
      content="A Python-based interactive airspace visualization tool for viewing OpenAir airspace files."
    />
    <meta
      name="keywords"
      content="airspace, aviation, openair, visualization, flight, navigation, map"
    />
    <meta name="author" content="Simon Steiner" />

    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet" />

    <!-- Airspace colors injected from server -->
    <link
      rel="stylesheet"
      href="{{ url_for('main.css_colors') }}"
    />
  </head>

  <body>
    <div id="wrapper">
      <!-- Header -->
      <header class="main-header">
        <h1>Airspace Viewer ‚úà</h1>
        <p>
          Drag and drop an OpenAir-format airspace file onto the map, or use the
          file upload function.
        </p>
      </header>

      <!-- Flash messages -->
      <div class="flash-messages">
        {% with messages = get_flashed_messages(with_categories=true) %} {% if
        messages %} {% for category, message in messages %}
        <div
          class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show"
          role="alert"
        >
          {{ message }}
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="alert"
            title="alert"
          ></button>
        </div>
        {% endfor %} {% endif %} {% endwith %}
      </div>

      <!-- Map container -->
      <div id="map"></div>

      <!-- Drag and drop overlay -->
      <div id="dropzone">
        <div>
          <i
            class="bi bi-cloud-upload"
            style="font-size: 48px; margin-bottom: 20px"
          ></i>
          <div>Drop your OpenAir file here.</div>
          <div style="font-size: 16px; margin-top: 10px; opacity: 0.8">
            Supported formats: .txt, .air, .openair
          </div>
        </div>
      </div>

      <!-- Control panel -->
      <div class="control-panel minimized" id="controlPanel">
        <div class="control-header" onclick="toggleControlPanel()">
          <h6>üìÅ File Upload</h6>
          <button class="toggle-btn" id="toggleBtn">‚ñº</button>
        </div>
        <div class="control-content" id="controlContent">
          <form
            action="/upload"
            method="post"
            enctype="multipart/form-data"
            class="file-upload"
          >
            <input
              type="file"
              class="form-control form-control-sm"
              name="file"
              accept=".txt,.air,.openair"
              title="Upload OpenAir file"
              placeholder="Select file"
              required
            />
            <button type="submit" class="btn btn-primary btn-sm mt-2">
              Upload
            </button>
          </form>
        </div>
      </div>

      <!-- File info display -->
      <div class="file-info-display" id="fileInfoDisplay">
        <div class="file-info-content">
          <span class="file-info-item">
            üìÅ <strong>{{ current_file }}</strong>
          </span>
          <span class="file-info-separator">‚Ä¢</span>
          <span class="file-info-item">
            üìä <strong>{{ airspace_count }}</strong> airspaces
          </span>
          {% if current_file != 'Switzerland.txt' %}
          <span class="file-info-separator">‚Ä¢</span>
          <span class="file-info-item">
            <a href="/reset" class="reset-link">Reset</a>
          </span>
          {% endif %}
        </div>
      </div>

      <!-- Airspace info panel (hidden by default) -->
      <div id="airspaceinfo" class="hidden">
        <div class="name airspace-name"></div>
        <div class="class"></div>
        <div class="bounds airspace-bounds"></div>
      </div>

      <!-- Legend -->
      <div class="legend">
        <h6>Airspace Classes</h6>
        {% for item in legend_data %}
        <div class="legend-item">
          <div class="legend-color" style="background: {{ item.color }};"></div>
          <span>{{ item.name }}</span>
        </div>
        {% endfor %}
      </div>
    </div>
    <footer>
      <p>
        <strong
          >Disclaimer: Educational use only. Data may be inaccurate or
          incomplete. Always use official sources.</strong
        >
      </p>
      <p>
        This version was created by Simon Steiner, is based on
        <a href="https://airspaces.bargen.dev/">Airspace Visualizer</a> by
        <a href="https://bargen.dev/">Danilo Bargen</a>. Powered by
        <a href="https://github.com/simonsteiner/openair-rs-py/" target="_blank"
          >openair-rs-py</a
        >
      </p>
    </footer>

    <!-- Leaflet JS -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="{{ url_for('main.js_config') }}"></script>
    <script src="{{ url_for('static', filename='js/map.js') }}"></script>
    <script src="{{ url_for('static', filename='js/airspace.js') }}"></script>
    <script src="{{ url_for('static', filename='js/drag_and_drop.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  </body>
</html>
